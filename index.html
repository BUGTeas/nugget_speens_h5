<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=10"/>
    <head>
        <title id="title"></title>
        <style>
            html,body{
                margin:0;
                height:100%;
            }
            #shadowbox{
                border-radius:100%;
                background:#555;
            }
            #option{
                position:absolute;
                z-index:3;
                background:rgba(0,0,0,0.2);
                top:0;
                padding:20px;
                width:calc(100% - 40px);
            }
            .range{
                width:200px;
            }
            .input{
                width:30px;
                border:1px solid #aaa;
                border-radius:5px;
                margin:5px;
                padding:2px;
            }
            hr{
                border:0.5px solid #aaa;
            }
        </style>
        <style id="animationset"></style>
    </head>
    <body>
        <!--效果-->
        <div id="headbox"></div>
        <div id="rotationbox"><div style="width:100%;height:100%;background:#ccc"></div></div>
        <div id="shadowbox"></div>

        <!--右上角选项按钮-->
        <div id="tips" style="position:absolute;top:5px;right:65px;display:none">点击此处进入选项→</div>
        <button id="optbtn" style="border:none;background:rgba(0,0,0,0.4);color:#fff;position:absolute;top
        :0px;right:0px;padding:5px 15px 5px 15px;font-size:15px;display:none" onclick="document.getElementById('option').style.display = 'block';this.style.display = 'none';document.getElementById('tips').remove();">选项</button>

        <div id="option">
            <div style="">
                <!--效果设置-->
                X轴：<br><input id='Xanglerange' class="range" type='range' min='0' max='360' oninput="anglechange('xrange')"/><input id='Xangleinput' class="input" value='0' oninput='anglechange()'/>°<hr>
                Z轴：<br><input id='Zanglerange' class="range" type='range' min='0' max='360' oninput="anglechange('zrange')"/><input id='Zangleinput' class="input" value='0' oninput='anglechange()'/>°<hr>
                透视：<br><input id='perspectrange' class="range" type='range' min='0' max='1000' oninput="anglechange('prange')"/><input id='perspectinput' class="input" value='500' oninput='anglechange()'/>像素<hr>
                速度：<br><input id='speedrange' class="range" type='range' min='1' max='10000' oninput="anispeed('range')"/><input id='speedinput' class="input" value='1.3' oninput='anispeed()'/>秒
            </div>

            <div>
                <!--文字/代码设置界面-->
                <p style="margin:5px;font-size:20px;text-align:center">文本或 HTML</p>
                <p style='margin:5px;text-align:center'>如需换行，请使用“&lt;/br&gt;”</p>
                <textarea rows="5" id="inputtext" style="width:100%" oninput="applytext()">旋转 の 页面</textarea>
                字体大小：<input id='textsizerange' class="range" type='range' min='0' max='360' value='72' oninput="applytext('sizerange')"/><input id='textsizeinput' class="input" value="72" class="input" oninput='applytext()'/>像素

                <!--图片设置界面-->
                <p style="margin:5px;font-size:20px;text-align:center">图片</p>
                <p style='margin:5px;text-align:center'>图片大小不建议超过2M，否则浏览器会卡顿甚至闪退</p>
                <div><input id='anyinput' type='file' style='width:100%;border:2px solid #ccc;background:#ccc'/></div>
                宽度<br><input id='range' class="range" type='range' min='0' max='500' value='150' oninput='applyimg()'/><input id='userwidth' value='150' class="input" oninput='applyimg()'/> 像素
            </div>
            <button style="margin-left:calc(50% - 50px);width:100px;background:rgb(46, 102, 255);color:#fff;border:0;border-radius:5px;height:30px;font-size:15px" onclick="document.getElementById('option').style.display = 'none';document.getElementById('optbtn').style.display = 'block';document.getElementById('tips').style.display = 'block'">关闭</button>
        </div>

        <script type="text/JavaScript">
            
            //旋转框架尺寸
            lastsize = 0;
            function resizebox(){
                var rotationbox = document.getElementById("rotationbox");
                var shadowbox = document.getElementById("shadowbox");
                var winbody = document.body;
                if(winbody.clientWidth - winbody.clientHeight!=lastsize){
                    if(document.getElementById("showimg")){
                        boxWidth = document.getElementById("showimg").clientWidth;
                        boxHeight = document.getElementById("showimg").clientHeight;
                    }else if(document.getElementById("showtext")){
                        boxWidth = document.getElementById("showtext").clientWidth;
                        boxHeight = document.getElementById("showtext").clientHeight;
                    }else{
                        boxWidth = "300";
                        boxHeight = "300";
                    }
                    rotationbox.style.width = boxWidth + "px";
                    rotationbox.style.height = boxHeight + "px";
                    shadowbox.style.width = boxWidth + "px";
                    shadowbox.style.height = boxHeight / 5 + "px";
                    document.getElementById("title").innerHTML = "万物皆可旋转（" + rotationbox.style.width + " x " + rotationbox.style.height + "）";
                    headheight = (winbody.clientHeight - rotationbox.clientHeight) / 2
                    anglechange();
                    rotationbox.style.marginLeft = (winbody.clientWidth - rotationbox.clientWidth) / 2 + "px";
                    shadowbox.style.marginLeft = (winbody.clientWidth - rotationbox.clientWidth) / 2 + "px";
                    lastsize = winbody.clientWidth - winbody.clientHeight
                }
                setTimeout(function(){resizebox()},25)
            }
            resizebox();
            
            //旋转框架角度/透视
            function anglechange(mode){
                var xinput = document.getElementById("Xangleinput");
                var xrange = document.getElementById("Xanglerange");
                var zinput = document.getElementById("Zangleinput");
                var zrange = document.getElementById("Zanglerange");
                var pinput = document.getElementById("perspectinput");
                var prange = document.getElementById("perspectrange");
                var aniset = document.getElementById("animationset");
                if(mode=="xrange"){
                    xinput.value = xrange.value - 180;
                }else if(mode=="zrange"){
                    zinput.value = zrange.value - 180;
                }else if(mode=="prange"){
                    pinput.value = 1000 - prange.value;
                }else{
                    xrange.value = Number(xinput.value) + 180;
                    zrange.value = Number(zinput.value) + 180;
                    prange.value = 1000 - pinput.value;
                }
                aniset.innerHTML = "@keyframes headanimation{0%{height:" + headheight + "px}50%{height:" + Number(headheight - 40) + "px}100%{height:" + headheight + "px}}@keyframes shadowanimation{0%{filter:blur(20px);margin-top:20px}50%{filter:blur(30px);margin-top:60px}100%{filter:blur(20px);margin-top:20px}}@keyframes boxanimation{0%{transform:perspective(" + pinput.value + "px) rotateX(" + xinput.value + "deg) rotateY(0deg) rotateZ(" + zinput.value + "deg)}100%{transform:perspective(" + pinput.value + "px) rotateX(" + xinput.value + "deg) rotateY(360deg) rotateZ(" + zinput.value + "deg)}}"
            }

            function anispeed(mode){
                var input = document.getElementById("speedinput");
                var range = document.getElementById("speedrange")
                if(mode=="range"){input.value = range.value / 1000;}
                else{range.value = input.value * 1000;}
                document.getElementById("rotationbox").style.animation = "boxanimation " + input.value + "s infinite linear";
                document.getElementById("shadowbox").style.animation = "shadowanimation " + input.value * 1.5 + "s infinite linear";;
                document.getElementById("headbox").style.animation = "headanimation " + input.value * 1.5 + "s infinite linear";;
            }
            //用户导入图片
            if(window.FileReader){
                document.body.innerHTML += "";
                anyimg = document.getElementById("anyinput");
                anyimg.addEventListener('change',imageget,false);
            }else{
                alert("您的浏览器不支持自定义图片。");
            }
            function imageget(){
                var file = anyimg.files[0];
                if(!/image\/\w+/.test(file.type)){
                    alert("请确保文件为图像类型,否则将无法显示");
                }
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function(e){;
                    imgSrc = this.result;
                    applyimg();
                }
            }

            //应用图片
            function applyimg(){
                document.getElementById("userwidth").value = document.getElementById("range").value;
                var element = "<img src='" + imgSrc + "' id='showimg' style='width:" + document.getElementById("userwidth").value + "px'/>";
                document.getElementById("rotationbox").innerHTML = element;
                lastsize = 0;
            }

            //应用文字
            function applytext(mode){
                if(document.getElementById("showimg")) document.getElementById("showimg").remove();
                var sizeinput = document.getElementById("textsizeinput");
                var sizerange = document.getElementById("textsizerange");
                var txtinput = document.getElementById("inputtext");
                document.getElementById("rotationbox").innerHTML = "<div id='showtext'>" + txtinput.value + "</div>"
                var txtset = document.getElementById("showtext");
                if(mode=="sizerange"){sizeinput.value = sizerange.value}
                else{sizerange.value = sizeinput.value}
                txtset.style = "white-space:nowrap;float:left;font-size:" + sizeinput.value + "px;color:";
                lastsize = 0;
            }
            imgSrc = "./nugget.png"
            applyimg();
            anispeed();
            anglechange();
        </script>
    </body>
</html>